angular.module("angular-simple-table",[]).directive("simpleTable",["$filter","$compile","filterFilter",function(a,b,c){window.TableSettings=function(b){function c(b,c,d){var e=[],f=c||"$";e[f]=b;var g=a("filter")(d,e,!1);return g}function d(b,c,d){var e=c.split("."),f=[];f[e[1]]=b;var h=[];return d.forEach(function(b,c,d){var i=a("filter")(b[e[0]],f,!1);i.length>0&&h.push(g[c])}),h}function e(a){for(var b={},c=a.length-1;c>=0;c--){var d=JSON.stringify(a[c]);b[d]?a.splice(c,1):b[d]=!0}return a}this.data=b||null,this.reverseSort=!1,this.orderField=null,this.itemsPerPage=25,this.searchFields={};var f=1,g=null;this.getCurrentPage=function(){return f},this.setCurrentPage=function(a){f=a},this.getTotalPagesArray=function(){return g?new Array(Math.ceil(g.length/this.itemsPerPage)):void 0},this.getTotalPages=function(){return g?Math.ceil(g.length/this.itemsPerPage):void 0},this.getFilteredData=function(){if(this.data instanceof Array||"object"!=typeof this.data||null===this.data)g=this.data;else{var b=Object.keys(this.data);g=this.data,g=b.map(function(a){return g[a]})}if(Object.keys(this.searchFields).length){var h=[];for(var i in this.searchFields)if(this.searchFields.hasOwnProperty(i)){if(-1===i.indexOf("."))var j=c(this.searchFields[i],i,g);else var j=d(this.searchFields[i],i,g);j.forEach(function(a,b,c){h.push(a)})}g=e(h)}if("string"==typeof this.orderField&&(g=a("orderBy")(g,this.orderField.toLowerCase(),this.reverseSort)),g&&this.data){var k=(f-1)*this.itemsPerPage;return k>g.length&&this.setCurrentPage(1),g.slice(k,k+this.itemsPerPage)}g=this.data},this.search=function(a,b){if(f=1,this.orderField=null,this.searchFields={},arguments.length<2){var b=arguments[1]||"$";this.searchFields[b]=arguments[0]}else for(var c=1;c<arguments.length;c++){var b=arguments[c];this.searchFields[b]=arguments[0]}console.log(this.searchFields)},this.orderBy=function(a,b){this.orderField=a,b||(this.reverseSort=!this.reverseSort)}};var d=function(a,c,d){b(c);var e=document.querySelectorAll("[simple-table]"),f=d.simpleTable;for(var g in e)if(e.hasOwnProperty(g)){var h=e[g];d.simpleTable===h.getAttribute("simple-table")&&"TABLE"===h.tagName&&(a.table=e[g])}c.prepend(document.createElement("tHead")),a.$watch(function(){var b=a.table.children[1].children[0];return b},function(c,d){if("undefined"!=typeof c){var e=c,g=a.table.children[0];g.innerHTML="";var h=e.children,i=document.createElement("tr");for(var j in h)if(h.hasOwnProperty(j)){var k=document.createElement("th"),l=h[j].getAttribute("data-sort-by");if(l){var m=h[j].getAttribute("title")||"";k.innerHTML='<a href="javascript:void(0)" ng-click="'+f+".orderBy('"+l+"')\" >"+m+'&nbsp;&nbsp;<span ng-show="'+f+".orderField == '"+l+'\'"><span ng-show="!'+f+'.reverseSort">&#9650;</span><span ng-show="'+f+'.reverseSort">&#9660;</span></span></a>'}else k.innerHTML=h[j].getAttribute("title");i.appendChild(k)}var n=b(i)(a.$parent);g.appendChild(n[0])}})};return{scope:{simpleTable:"&"},restrict:"EA",template:"",link:d}}]);